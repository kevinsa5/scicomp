<!DOCTYPE html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Interpreter Testbed</title>
            <script type = "text/javascript" src = "http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.7.0/math.min.js"></script>
        <script type="text/javascript" src="/global/taboverride.js"></script>
        <script type="text/javascript" src="CharacterStream.js"></script>
        <script type="text/javascript" src="TokenStream.js"></script>
        <script type="text/javascript" src="ASTStream.js"></script>
        <script type="text/javascript" src="OutputStream.js"></script>
        <script type="text/javascript" src="Scope.js"></script>
        <script type="text/javascript" src="Builtins.js"></script>
        <script type="text/javascript" src="Interpreter.js"></script>
        <script type="text/javascript">
window.onload = function(){
tabOverride.tabSize(4);
tabOverride.autoIndent(true);
tabOverride.tabKey(9).untabKey(9, ['shift']);
var textarea = document.getElementById("code");
tabOverride.set(textarea);
}
        </script>
        <script type="text/javascript">
function tokenize(){
var out = new OutputStream();
out.setTarget($("#output"));
out.clear();
var tokenizer = new TokenStream(new CharacterStream(document.getElementById('code').value));
while(!tokenizer.empty()){
    try {
        var tok = tokenizer.next();
        out.println(tok.type + ":" + tok.value);
    } catch(e){
        console.log(e);
        out.println(e);
        return;
    }
}
}
        </script>
        <script type="text/javascript">
function parse2(){
var out = new OutputStream();
out.setTarget($("#output"));
out.clear();
var ast = new AST(new TokenStream(new CharacterStream(document.getElementById('code').value)));
try{
    var tree = ast.generate();
    out.print(JSON.stringify(tree, null, '\t'));
} catch(e){
    out.print(e);
}
}
function parse(){
var out = new OutputStream();
out.setTarget($("#output"));
out.clear();
var ast = new AST(new TokenStream(new CharacterStream(document.getElementById('code').value)));
while(!ast.empty()){
    try{
        var exp = ast.next();
        out.println(JSON.stringify(exp, null, '\t'));
        out.println("~~~~~~~~~~~~~~~~~");
    } catch(e){
        out.println(e);
    }
}
}
function run(){
var out = new OutputStream();
out.setTarget($("#output"));
out.clear();
var ast = new AST(new TokenStream(new CharacterStream(document.getElementById('code').value)));
var interp = new Interpreter(ast, out);
interp.run();
}

        </script>
    </head>
<body>
<p>Note: this may not work in Firefox &lt;45 and chromium/chrome &lt;49. </p>
<textarea id="code" cols="80" rows="20" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'    '+v.substring(e);this.selectionStart=this.selectionEnd=s+4;return false;}">
line = lambda(){
    for(i in 1:50){print("~");};
    println("");
};

# function definition, if/else
myfunc = lambda(a, b){
    if(a &lt;= b){
        println(a);
    };
    b = 6;
    if(b &gt; 5){println("more");} else {println("less");};
};

myfunc(1,2);
line();

# these two lines are different!
println(2*3+4);
println(2*(3+4));
line();

# recursion, value of last evaluated expression is implicit return value
fib = lambda(n) {
    if(n &lt; 2){
        result = 1;
    } else {
        result = fib(n-1) + fib(n-2);
    };
};

# for loop, colon notation
for(i in 5:2:15){
    print("the ", i, "th fibonacci number is ", fib(i));
    println("");
};
line();

# while loop (Collatz Conjecture)
n = 6;
while(n != 1){
    println(n);
    if(n % 2 == 0){
        n = n/2;
    } else {
        n = 3*n+1;
    };
};
line();

# scoping
thisvar = 0;
if(thisvar &gt; 5){
    anon = lambda(a,b) {a*b;};
} else {
    anon = lambda(a,b) {a/b;};
};
println(anon(10,2));
line();

# vectors and indexing
a = [[1,2,3],
     [4,5,6],
     [7,8,9]];
for(i in 0:2){
    for(j in 0:2){
        println(a[i][j]);
    };
};

line();
for(row in a){
    for(elem in row){
        println(elem);
    };
};
</textarea>
<br>
<button onclick="tokenize();">Tokenize</button>
<button onclick="parse();">Generate AST</button>
<button onclick="run();">Run Code</button>
<br>
<pre id="output" style="border:2px solid #000;max-height:200px;max-width:650px;overflow:auto;display:block;white-space:pre-wrap"></pre>
</body>
