<!DOCTYPE html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Interpreter Testbed with Web Workers</title>
        <script type="text/javascript" src="OutputStream.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

        <script type="text/javascript">
var worker;
var out = new OutputStream();
window.onload = function(){ out.setTarget($("#output")); };


function makeWorker(){
    out.clear();
    worker = new Worker("worker.js");
    worker.addEventListener('message', function(e)
    {
       out.print(e.data);
    }, false);
    worker.addEventListener('onerror', function(e)
    {
        out.print(e.message);
    }, false);
}

function tokenize(){
    makeWorker();
    var info = {command:"tokenize", data:document.getElementById("code").value};
    worker.postMessage(info);
}

function AST(){
    makeWorker();
    var info = {command:"AST", data:document.getElementById("code").value};
    worker.postMessage(info);
}

function run(){
    makeWorker();
    var info = {command:"execute", data:document.getElementById("code").value};
    worker.postMessage(info);
}

function kill(){
    if(worker){
        worker.terminate();
        out.println("Interpreter thread killed.");
    } else {
        out.println("No worker running.");
    }
}

        </script>
    </head>
<body>
<p>Note: this may not work in Firefox &lt;45 and chromium/chrome &lt;49. </p>
<textarea id="code" cols="80" rows="30" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'    '+v.substring(e);this.selectionStart=this.selectionEnd=s+4;return false;}">
line = lambda(){
    for(i in 1:50){print("~");};
    println("");
};

# function definition, if/else
myfunc = lambda(a, b){
    if(a &lt;= b){
        println(a);
    };
    b = 6;
    if(b &gt; 5){println("more");} else {println("less");};
};

myfunc(1,2);
line();

# these two lines are different!
println(2*3+4);
println(2*(3+4));
line();

# recursion, value of last evaluated expression is implicit return value
fib = lambda(n) {
    if(n &lt; 2){
        result = 1;
    } else {
        result = fib(n-1) + fib(n-2);
    };
};

# for loop, colon notation
for(i in 5:2:15){
    print("the ", i, "th fibonacci number is ", fib(i));
    println("");
};
line();

# while loop (Collatz Conjecture)
n = 6;
while(n != 1){
    println(n);
    if(n % 2 == 0){
        n = n/2;
    } else {
        n = 3*n+1;
    };
};
line();

# scoping
thisvar = 0;
if(thisvar &gt; 5){
    anon = lambda(a,b) {a*b;};
} else {
    anon = lambda(a,b) {a/b;};
};
println(anon(10,2));
line();

# vectors and indexing
a = [[1,2,3],
     [4,5,6],
     [7,8,9]];
for(i in 0:2){
    for(j in 0:2){
        println(a[i][j]);
    };
};

line();
for(row in a){
    for(elem in row){
        println(elem);
    };
};
</textarea>
<br>
<button onclick="tokenize();">Tokenize</button>
<button onclick="AST();">Generate AST</button>
<button onclick="run();">Run Code</button>
<button onclick="kill();">Kill Thread</button>
<br>
<pre id="output" style="border:2px solid #000;max-height:200px;max-width:650px;overflow:auto;display:block;white-space:pre-wrap"></pre>
</body>
